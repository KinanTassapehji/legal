<div class="main-container">
    <div class="row">
      <div class="col-sm-12">
        <ngx-skeleton-loader count="1" [theme]="{width:'250px',height:'20px','margin-bottom': '1rem', 'background-color': '#e7edf4', }" animation="pulse" appearance="line" *ngIf="isLoading" />
        <h2 *ngIf="!isLoading">Welcome Onboard</h2>
        <div class="card on-boarding-skeleton-card" *ngIf="isLoading">
            <div class="obs-cont">
                <div class="obs-left">                    
                    <ngx-skeleton-loader count="4" [theme]="{width:'395px',height:'72px','margin-bottom': '0.5rem', 'background-color': '#e7edf4', }" animation="pulse" appearance="line" />
                </div>
                <div class="obs-right">
                    <div class="obs-header">
                        <ngx-skeleton-loader count="1" [theme]="{width:'115px',height:'20px','margin-bottom': '0.25rem', 'background-color': '#e7edf4', }" animation="pulse" appearance="line" />
                        <ngx-skeleton-loader count="1" [theme]="{width:'285px',height:'30px','margin-bottom': '1rem', 'background-color': '#e7edf4', }" animation="pulse" appearance="line" />
                    </div>
                    <ngx-skeleton-loader count="3" [theme]="{width:'100%',height:'55px','margin-bottom': '0.5rem', 'background-color': '#e7edf4', }" animation="pulse" appearance="line" />
                </div>
            </div>
            <div class="obs-footer">
                <ngx-skeleton-loader count="1" [theme]="{width:'75px',height:'40px','margin': '0', 'background-color': '#e7edf4', }" animation="pulse" appearance="line" />
            </div>
        </div>
        <div *ngIf="progressBar">
          <mat-progress-bar mode="indeterminate" value="30"></mat-progress-bar>
        </div>
        <div class="card onboarding-card" *ngIf="!isLoading">
          <mat-tab-group class="conboarding-tab-wizard" [selectedIndex]="selectedIndex" (selectedTabChange)="onTabChanged($event)">
            <!-- Account Tab -->
            <form novalidate #fAccount="ngForm">
              <mat-tab>
                <ng-template mat-tab-label>
                  <div class="on-boarding-header-cont">
                    <div class="ob-step-number">1</div>
                    <div class="ob-title-section">
                      <div class="ob-header-title">Account</div>
                      <div class="ob-header-subtitle">Account details</div>
                    </div>
                  </div>
                </ng-template>
                <div class="ob-container-section">
                  <div class="row dense-2">
                    <div class="col-sm-12">
                      <div class="ob-cont-title">Account</div>
                      <div class="ob-cont-subtitle">Please fill the following details.</div>
                    </div>
                    <div class="col-sm-12">
                      <mat-form-field appearance="outline" class="w-100">
                        <mat-label>Account name</mat-label>
                        <input matInput [(ngModel)]="Name" name="Name" required (change)="checkAccountFields(fAccount?.invalid)">
                        <mat-error *ngIf="fAccount.controls['Name']?.invalid && (fAccount.controls['Name'].dirty || fAccount.controls['Name'].touched)">
                          Please enter a valid account name.
                        </mat-error>
                      </mat-form-field>
                    </div>
                    <div class="col-sm-12">
                      <mat-form-field appearance="outline" class="w-100">
                        <mat-label>Account email</mat-label>
                        <input type="email" matInput [(ngModel)]="Email" name="Email" required email (change)="checkAccountFields(fAccount?.invalid)">
                        <mat-error *ngIf="fAccount.controls['Email']?.invalid && (fAccount.controls['Email'].dirty || fAccount.controls['Email'].touched)">
                          Please enter a valid email address.
                        </mat-error>
                      </mat-form-field>
                    </div>
                    <div class="col-sm-12">
                      <mat-form-field appearance="outline" class="w-100">
                        <mat-label>Account phone</mat-label>
                        <input type="tel" matInput [(ngModel)]="PhoneNumber" prefix="+" [showMaskTyped]="true" mask="000 000 000 000" name="PhoneNumber" required (change)="checkAccountFields(fAccount?.invalid)">
                        <mat-error *ngIf="fAccount.controls['PhoneNumber']?.hasError('pattern')">Please enter a valid phone number with country code.</mat-error>
                      </mat-form-field>
                    </div>
                    <mat-error *ngIf="errorMessage != ''">
                      {{errorMessage}}
                    </mat-error>
                  </div>
                </div>
              </mat-tab>
            </form>
         
            <!-- Application Tab -->
            <form novalidate #fApplication="ngForm">
              <mat-tab [disabled]="isApplicationDisabled">
                <ng-template mat-tab-label>
                  <div class="on-boarding-header-cont">
                    <div class="ob-step-number">2</div>
                    <div class="ob-title-section">
                      <div class="ob-header-title">Application</div>
                      <div class="ob-header-subtitle">Application, Instance details</div>
                    </div>
                  </div>
                </ng-template>
                <div class="ob-container-section">
                  <div class="row dense-2">
                    <div class="col-sm-12">
                      <div class="ob-cont-title">Application</div>
                      <div class="ob-cont-subtitle">Please fill the following details.</div>
                    </div>
                    <div class="col-sm-12">
                      <mat-form-field appearance="outline" class="w-100">
                        <mat-label>Application</mat-label>
                        <mat-select matInput [(ngModel)]="applicationId" name="applicationId" required (selectionChange)="onSelectCheckApplicationValidation(fApplication?.invalid)">
                          <mat-option *ngFor="let app of applications" [value]="app.id">{{app.name}}</mat-option>
                        </mat-select>
                      </mat-form-field>
                    </div>
                    <div class="col-sm-12">
                      <mat-form-field appearance="outline" class="w-100">
                        <mat-label>Account</mat-label>
                        <input matInput readonly [value]="Name">
                      </mat-form-field>
                    </div>
                    <div class="col-sm-12">
                      <mat-form-field appearance="outline" class="w-100">
                        <mat-label>Tenant name</mat-label>
                        <input matInput [(ngModel)]="tenantName" name="tenantName" required (change)="checkApplicationFields(fApplication?.invalid)">
                        <mat-error *ngIf="fApplication.controls['tenantName']?.invalid && (fApplication.controls['tenantName'].dirty || fApplication.controls['tenantName'].touched)">
                          Please enter a valid tenant name.
                        </mat-error>
                      </mat-form-field>
                    </div>
                    <div class="col-sm-12">
                      <mat-form-field appearance="outline" class="w-100">
                        <mat-label>Tenant Email</mat-label>
                        <input type="email" matInput [(ngModel)]="tenantEmail" name="tenantEmail" required email (change)="checkApplicationFields(fApplication?.invalid)">
                        <mat-error *ngIf="fApplication.controls['tenantEmail']?.invalid && (fApplication.controls['tenantEmail'].dirty || fApplication.controls['tenantEmail'].touched)">
                          Please enter a valid email address.
                        </mat-error>
                      </mat-form-field>
                    </div>
                    <div class="col-sm-12">
                      <mat-form-field appearance="outline" class="w-100" floatLabel="always">
                        <mat-label>Tenant Url</mat-label>
                        <input type="url" matInput [(ngModel)]="tenantUrl" name="tenantUrl" required placeholder="websiteurl.com" (change)="checkApplicationFields(fApplication?.invalid)">
                        <mat-error *ngIf="fApplication.controls['tenantUrl']?.invalid && (fApplication.controls['tenantUrl'].dirty || fApplication.controls['tenantUrl'].touched)">
                          Please enter a valid URL.
                        </mat-error>
                      </mat-form-field>
                    </div>
                    <mat-error *ngIf="errorMessage != ''">
                      {{errorMessage}}
                    </mat-error>
                  </div>
                </div>
              </mat-tab>
            </form>
            
            <!-- Subscription Plan Tab-->
            <form novalidate>
              <!-- [disabled]="isSubscriptionPlanDisabled" -->
              <mat-tab [disabled]="isSubscriptionPlanDisabled">
                <ng-template mat-tab-label>
                  <div class="on-boarding-header-cont">
                    <div class="ob-step-number">3</div>
                    <div class="ob-title-section">
                      <div class="ob-header-title">Subscription Plan</div>
                      <div class="ob-header-subtitle">Choose Subscription Plan</div>
                    </div>
                  </div>
                </ng-template>
                <div class="ob-container-section">
                  <div class="row">
                    <div class="card subscription-plan-table-card" *ngIf="dataSource.length > 0 && !isLoading">
                      <div class="onbording-subscription-header">
                        <button mat-raised-button color="primary" (click)="openAddSubscriptionPlanDialog()">Add Subscription Plan</button>
                      </div>
                      <div class="onbording-subscription-body">
                      <table mat-table [dataSource]="dataSource" class="subscription-plan-table mat-elevation-z0">
                        <!-- Dynamic column definition -->
                        <ng-container *ngFor="let column of displayedColumns; let i=index" [matColumnDef]="column">
                          <th mat-header-cell *matHeaderCellDef>
                            <div class="subscription-table-header">
                              <span>{{ column }}</span>
                            </div>
                          </th>
                          <td mat-cell *matCellDef="let element">{{ element[column] }}</td>
                          <td mat-footer-cell *matFooterCellDef>
                            <button mat-raised-button *ngIf="i > 0" (click)="selectPlan(column, $event)" class="w-100">Choose Plan</button>
                          </td>
                        </ng-container>
                        <!-- Header row -->
                        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                        <!-- Data rows -->
                        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                        <!-- Mat Footer Cell -->
                        <tr mat-footer-row *matFooterRowDef="displayedColumns"></tr>
                      </table>
                    </div>
                    </div>
                    <div class="" *ngIf="dataSource.length == 0">
                      <h1 class="subscription-table-header">Subscription Plan Not Found</h1>
                    </div>
                    <mat-error *ngIf="errorMessage != ''">
                      {{errorMessage}}
                    </mat-error>
                  </div>
                </div>
              </mat-tab>
            </form>

            <!--  License Tab-->
            <form novalidate #fLicense="ngForm">
              <mat-tab [disabled]="isLicenseDisabled">
                <ng-template mat-tab-label>
                  <div class="on-boarding-header-cont">
                    <div class="ob-step-number">4</div>
                    <div class="ob-title-section">
                      <div class="ob-header-title">License</div>
                      <div class="ob-header-subtitle">Choose License</div>
                    </div>
                  </div>
                </ng-template>
                <div class="ob-container-section">
                  <div class="row dense-2">
                    <div class="col-sm-12">
                      <div class="ob-cont-title">License</div>
                      <div class="ob-cont-subtitle">Please fill the following details.</div>
                    </div>
                    <div class="col-sm-12">
                      <mat-form-field appearance="outline" class="w-100">
                        <mat-label>Environment</mat-label>
                        <mat-select matInput required [(ngModel)]="environment" name="environment" (selectionChange)="checkLicenseFields(fLicense?.invalid)">
                          <mat-option value="Production">Production</mat-option>
                          <mat-option value="Staging">Staging</mat-option>
                        </mat-select>
                      </mat-form-field>
                    </div>
                    <div class="col-sm-12 col-md-6">
                      <mat-form-field appearance="outline" class="w-100">
                        <mat-label>No of Machines</mat-label>
                        <input type="number" matInput [(ngModel)]="maximumMachines" name="maximumMachines" required>
                      </mat-form-field>
                    </div>
                    <div class="col-sm-12 col-md-6">
                      <mat-form-field appearance="outline" class="w-100">
                        <mat-label>Maximum remaining days to escalate</mat-label>
                        <input type="number" matInput [(ngModel)]="maximumRemainingDaysToEscalate" name="maximumRemainingDaysToEscalate" required>
                      </mat-form-field>
                    </div>
                    <div class="col-sm-12">
                      <div class="license-type-container">
                        <h5>License Type</h5>
                        <mat-radio-group aria-label="Select an option" [(ngModel)]="expiryType" name="expiryType" required>
                          <mat-radio-button [value]="expiryTypeEnum.Limited">{{expiryTypeEnum.Limited}}</mat-radio-button>
                          <mat-radio-button [value]="expiryTypeEnum.UnLimited">{{expiryTypeEnum.UnLimited}}</mat-radio-button>
                        </mat-radio-group>
                      </div>
                    </div>
                    <ng-container *ngIf="expiryType === expiryTypeEnum.Limited">
                      <div class="col-sm-12 col-md-6">
                        <mat-form-field appearance="outline" class="w-100">
                          <mat-label>Expiry Date</mat-label>
                          <input matInput [matDatepicker]="picker" (dateInput)="onDateChange($event.value)" name="expiryDate" required>
                          <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                          <mat-datepicker #picker></mat-datepicker>
                        </mat-form-field>
                      </div>
                      <div class="col-sm-12 col-md-6">
                        <mat-form-field appearance="outline" class="w-100">
                          <mat-label>Expiry Action</mat-label>
                          <mat-select [(ngModel)]="expiryAction" name="expiryAction" required>
                            <mat-option *ngFor="let policy of violationPolicies" [value]="policy">
                              {{ policy }} Policy
                            </mat-option>
                          </mat-select>
                        </mat-form-field>
                      </div>
                    </ng-container>
                    <mat-error *ngIf="errorMessage != ''">
                      {{errorMessage}}
                    </mat-error>
                  </div>
                </div>
              </mat-tab>
            </form>
          </mat-tab-group>
            <div class="ob-container-footer-section">
              <button mat-raised-button (click)="previousTab()" [ngClass]="{'hide-btn': selectedIndex === 0}">Previous</button>
              <button mat-raised-button (click)="nextTab()" color="primary"  [ngClass]="{'hide-btn': selectedIndex === tabLabels.length - 1}">Next</button>
              <button mat-raised-button (click)="finished()" color="primary" style="display: none;" [ngClass]="{'show-btn': selectedIndex === tabLabels.length - 1}" >Finish</button>
            </div>
        </div>
      </div>
    </div>
</div>
